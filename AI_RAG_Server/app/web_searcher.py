# app/law_searcher.py
import re
from links_db import LAWS_DATABASE

class LawSearcher:
    def __init__(self):
        self.database = LAWS_DATABASE
    
    def web_searcher(self, law_name):
        """–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –∑–∞–∫–æ–Ω–∞ –≤ –±–∞–∑–µ"""
        law_lower = law_name.lower().strip()
        print(f"üîç –ü–æ–∏—Å–∫ –∑–∞–∫–æ–Ω–∞: {law_name}")
        
        # 1. –ü—Ä—è–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        if law_lower in self.database:
            url = self.database[law_lower]
            print(f"‚úÖ –ü—Ä—è–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: {url}")
            return url
        
        # 2. –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        for key, url in self.database.items():
            if key.lower() in law_lower:
                print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É '{key}': {url}")
                return url
        
        # 3. –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º
        url = self._smart_search(law_lower)
        if url:
            return url
        
        print(f"‚ùå –°—Å—ã–ª–∫–∞ –¥–ª—è '{law_name}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        return None
    
    def _smart_search(self, law_name):
        """–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º –Ω–∞–∑–≤–∞–Ω–∏—è"""
        # –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–∞ (–Ω–æ–º–µ—Ä–∞ —Å—Ç–∞—Ç–µ–π)
        numbers = re.findall(r'\d+', law_name)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–∫–æ–Ω–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        law_keywords = {
            '—Ä–µ–∫–ª–∞–º': ['—Ñ–∑-38', '–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π –∑–∞–∫–æ–Ω –æ —Ä–µ–∫–ª–∞–º–µ'],
            '—É–∫': ['—Å—Ç.136', '–£–≥–æ–ª–æ–≤–Ω—ã–π –∫–æ–¥–µ–∫—Å'],
            '—É–≥–æ–ª–æ–≤': ['—Å—Ç.136', '–£–≥–æ–ª–æ–≤–Ω—ã–π –∫–æ–¥–µ–∫—Å'],
            '–∫–æ–Ω—Å—Ç–∏—Ç—É—Ü': ['—Å—Ç.19', '–ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è'],
            '–∫–æ–∞–ø': ['–ö–æ–ê–ü'],
            '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤': ['–ö–æ–ê–ü'],
            '–≥—Ä–∞–∂–¥–∞–Ω—Å–∫': ['–ì–ö –†–§'],
            '—Ç—Ä—É–¥–æ–≤': ['–¢–ö –†–§'],
            '–Ω–∞–ª–æ–≥': ['–ù–ö –†–§'],
            '–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª': ['–ó–∞–∫–æ–Ω –æ –∑–∞—â–∏—Ç–µ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π'],
            '–∫–æ–Ω–∫—É—Ä–µ–Ω—Ü': ['–§–ó-135'],
            '–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω': ['–§–ó-152'],
            '—Å–º–∏': ['–ó–∞–∫–æ–Ω –æ –°–ú–ò'],
            '–∏–Ω—Ñ–æ—Ä–º–∞—Ü': ['–§–ó-149'],
            '–ª–µ–∫–∞—Ä—Å—Ç–≤': ['—Ä–µ–∫–ª–∞–º–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤'],
            '–∞–ª–∫–æ–≥–æ–ª': ['—Ä–µ–∫–ª–∞–º–∞ –∞–ª–∫–æ–≥–æ–ª—è'],
            '—Ç–∞–±–∞–∫': ['—Ä–µ–∫–ª–∞–º–∞ —Ç–∞–±–∞–∫–∞'],
            '—Ñ–∏–Ω–∞–Ω—Å': ['—Ä–µ–∫–ª–∞–º–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —É—Å–ª—É–≥'],
            '–±–∞–Ω–∫–æ–≤—Å–∫': ['—Ä–µ–∫–ª–∞–º–∞ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —É—Å–ª—É–≥'],
        }
        
        # –ò—â–µ–º –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        for keyword, law_keys in law_keywords.items():
            if keyword in law_name:
                for law_key in law_keys:
                    if law_key in self.database:
                        print(f"‚úÖ –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ '{keyword}': {self.database[law_key]}")
                        return self.database[law_key]
        
        # –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Å—Ç–∞—Ç—å–∏
        if numbers:
            for num in numbers:
                # –ò—â–µ–º —Å—Ç–∞—Ç—å–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
                search_patterns = [f"—Å—Ç.{num}", f"—Å—Ç {num}", f"—Å—Ç–∞—Ç—å—è {num}", num]
                for pattern in search_patterns:
                    if pattern in self.database:
                        print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ –ø–æ –Ω–æ–º–µ—Ä—É {num}: {self.database[pattern]}")
                        return self.database[pattern]
        
        return None

law_searcher = LawSearcher()